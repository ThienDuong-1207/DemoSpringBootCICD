# ==========================================================
# üß© T√äN WORKFLOW
# ==========================================================
# ƒê√¢y l√† pipeline CI/CD ƒë·ªÉ build & ki·ªÉm th·ª≠ ·ª©ng d·ª•ng Spring Boot
# m·ªói khi b·∫°n push code ho·∫∑c t·∫°o Pull Request.
# ==========================================================

name: Demo SpringBoot CI/CD

# ==========================================================
# üß© KHI N√ÄO WORKFLOW ƒê∆Ø·ª¢C K√çCH HO·∫†T
# ==========================================================
# - Khi c√≥ "push" (ƒë·∫©y code l√™n GitHub)
# - Ho·∫∑c khi c√≥ "pull request" (t·∫°o y√™u c·∫ßu g·ªôp code)
# ==========================================================

on:
  push:
    branches: ["main"] # ch·∫°y khi push v√†o nh√°nh main
  pull_request:
    branches: ["main"] # ch·∫°y khi c√≥ PR g·ª≠i v√†o nh√°nh main

# ==========================================================
# üß© KHAI B√ÅO C√îNG VI·ªÜC (JOB)
# ==========================================================
# T√™n job l√† "build", ch·∫°y tr√™n m√¥i tr∆∞·ªùng Ubuntu m·ªõi nh·∫•t
# ==========================================================

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ------------------------------------------------------
      # 1Ô∏è‚É£ L·∫§Y M√É NGU·ªíN T·ª™ REPOSITORY
      # ------------------------------------------------------
      # S·ª≠ d·ª•ng action ch√≠nh th·ª©c c·ªßa GitHub ƒë·ªÉ clone code repo
      # v·ªÅ m√°y ·∫£o runner trong qu√° tr√¨nh build.
      # ------------------------------------------------------
      - name: Checkout source code
        uses: actions/checkout@v4

      # ------------------------------------------------------
      # 2Ô∏è‚É£ C√ÄI ƒê·∫∂T PHI√äN B·∫¢N JDK D√ôNG CHO MAVEN
      # ------------------------------------------------------
      # - D√πng distribution: temurin (Eclipse Adoptium)
      # - Java version: 17 (LTS, ·ªïn ƒë·ªãnh cho Spring Boot 3.x)
      # - cache: maven gi√∫p l∆∞u dependency ƒë·ªÉ build nhanh h∆°n
      # ------------------------------------------------------
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
          cache: maven

      # ------------------------------------------------------
      # 3Ô∏è‚É£ KI·ªÇM TRA PHI√äN B·∫¢N JAVA TR√äN RUNNER
      # ------------------------------------------------------
      # B∆∞·ªõc n√†y gi√∫p b·∫°n x√°c minh runner th·ª±c s·ª± ƒëang d√πng
      # JDK 17 (tr√°nh l·ªói ‚Äúrelease version not supported‚Äù)
      # ------------------------------------------------------
      - name: Verify Java version
        run: java -version

      # ------------------------------------------------------
      # 4Ô∏è‚É£ BUILD PROJECT V·ªöI MAVEN
      # ------------------------------------------------------
      # - mvn clean package: xo√° file c≈©, build ra file jar m·ªõi.
      # - -DskipTests: b·ªè qua test khi build (cho nhanh h∆°n).
      # - --batch-mode: ch·∫ø ƒë·ªô kh√¥ng t∆∞∆°ng t√°c, ph√π h·ª£p CI/CD.
      # ------------------------------------------------------
      - name: Build with Maven
        run: mvn clean package -DskipTests --batch-mode

      # ------------------------------------------------------
      # 5Ô∏è‚É£ (T√ôY CH·ªåN) T·∫¢I FILE BUILD L√äN GITHUB
      # ------------------------------------------------------
      # Sau khi build xong, file .jar ƒë∆∞·ª£c l∆∞u ·ªü th∆∞ m·ª•c target/.
      # ƒêo·∫°n n√†y gi√∫p b·∫°n xem l·∫°i artifact ngay tr√™n tab Actions.
      # ------------------------------------------------------
      - name: Upload built JAR
        uses: actions/upload-artifact@v4
        with:
          name: springboot-jar
          path: target/*.jar
